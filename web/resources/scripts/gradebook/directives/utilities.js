// Generated by CoffeeScript 1.7.1
(function() {
  var _;

  _ = window._;

  angular.module('utilities', []).directive('utilities', function() {
    return {
      restrict: 'AE',
      templateUrl: '../templates/gradebook/utilities.html',
      link: function(scope, element, attrs) {
        scope.histogram = function() {
          scope.figureTitle = 'Histogram';
          scope.showUtilities = false;
          if (!scope.gradingScale) {
            return scope.loadGradingScale().success(function(result) {
              return scope.computeHistograms();
            });
          } else {
            return scope.computeHistograms();
          }
        };
        scope.computeHistograms = function() {
          var data, i, max;
          i = 0;
          data = _.countBy(scope.students, function(student) {
            var grade;
            grade = scope.computeGrade(student.totalGrade.score);
            return grade.lower;
          });
          max = 100;
          $.plot($("#figure"), [
            {
              label: null,
              data: _.pairs(data)
            }
          ], {
            series: {
              bars: {
                show: true,
                barWidth: 10
              },
              color: '#00a8ff'
            },
            xaxis: {
              ticks: 10,
              min: 0,
              max: max
            },
            yaxis: {
              tickSize: 1,
              tickDecimals: 0
            },
            grid: {
              backgroundColor: {
                colors: ["#fff", "#f8f8f8"]
              }
            }
          });
          return scope.hideGradebook = true;
        };
        scope.timeline = function() {
          var data, index;
          scope.figureTitle = 'Timeline';
          scope.showUtilities = false;
          data = [];
          index = 0;
          angular.forEach(scope.events, function(event) {
            data.push([index, event.average]);
            return index++;
          });
          $.plot($("#figure"), [
            {
              label: null,
              data: data
            }
          ], {
            series: {
              lines: {
                show: true,
                fill: false
              },
              points: {
                show: true,
                fill: false
              },
              color: '#00a8ff'
            },
            xaxis: {
              ticks: 10,
              min: 0
            },
            grid: {
              backgroundColor: {
                colors: ["#fff", "#f8f8f8"]
              },
              hoverable: true
            }
          });
          return scope.hideGradebook = true;
        };
        return scope.performance = function() {
          return console.log('you want to look at the classes performance');
        };
      }
    };
  }).directive('utilityView', function() {
    return {
      restrict: 'AE',
      templateUrl: '../templates/gradebook/figure.html'
    };
  });

}).call(this);

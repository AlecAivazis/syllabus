// Generated by CoffeeScript 1.7.1
(function() {
  var gradebook, updateCategoryLowers, updateCategoryUppers;

  gradebook = angular.module('gradebook-app', []);

  gradebook.controller('ClassSelect', function($scope, $http, $rootScope) {
    $scope.classes = [];
    $http.get('/api/classes/taughtByMe/').success(function(result) {
      return angular.forEach(result, function(item) {
        return $scope.classes.push(item);
      });
    });
    return $scope.loadGradeBook = function(id) {
      return $rootScope.gradebook_id = id;
    };
  });

  gradebook.controller('gradebook-view', function($scope, $rootScope, $http) {
    var class_id, refreshGradingScale;
    class_id = $rootScope.$watch('gradebook_id', function() {
      if (!$rootScope.gradebook_id) {
        return;
      }
      $http.get('/api/classes/' + $rootScope.gradebook_id + '/gradebook/').success(function(result) {
        $scope.breadcrumb = result.breadcrumb;
        $scope.events = result.events;
        $scope.gradebook = result.gradebook;
        return $scope.students = result.students;
      });
      return class_id = $rootScope.gradebook_id;
    });
    refreshGradingScale = true;
    $scope.toggleGradingScale = function() {
      if (refreshGradingScale) {
        $http.get('/api/classes/' + class_id + '/gradingScale/').success(function(result) {
          return $scope.gradingScale = result;
        });
        refreshGradingScale = false;
      }
      return $scope.showGradingScale = !$scope.showGradingScale;
    };
    $scope.showGradingScale = function() {
      var dataString;
      dataString = '';
      if ($('#gradeBookBreadCrumbs').attr('class')) {
        return $http({
          url: '/gradebook/gradingScale/view/',
          method: 'GET',
          params: {
            'section': $('#gradeBookBreadCrumbs').attr('section'),
            'class': $('#gradeBookBreadCrumbs').attr('class')
          }
        }).success(function(result) {
          $('#gradingScaleSelect').remove();
          return $('<div/>').attr({
            id: 'gradingScaleSelect'
          }).css('position', 'absolute').html(result).appendTo('#gutter');
        });
      }
    };
    updateCategoryUppers();
    return updateCategoryLowers();
  });

  updateCategoryUppers = function() {
    $('.category').not(':first').each(function() {
      return $(this).find('.categoryUpper').val(parseFloat($(this).parent().children().eq($(this).index() - 1).find('.categoryLower').val()));
    });
    return $('#closeGradingScaleSelect').unbind('click').bind('click', function() {
      return closeGradingScaleSelect(false);
    });
  };

  updateCategoryLowers = function() {
    $('.category').not(':last').each(function() {
      return $(this).find('.categoryLower').val(parseFloat($(this).parent().children().eq($(this).index() + 1).find('.categoryUpper').val()));
    });
    return $('#closeGradingScaleSelect').unbind('click').bind('click', function() {
      return closeGradingScaleSelect(false);
    });
  };

}).call(this);
